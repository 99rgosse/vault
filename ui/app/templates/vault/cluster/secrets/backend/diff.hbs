<PageHeader as |p|>
  <p.top>
    <KeyValueHeader
      @baseKey={{hash id=@model.id}}
      @path="vault.cluster.secrets.backend.show"
      @mode="show"
      @showCurrent={{true}} 
      @root={{backendCrumb}}
    />
  </p.top>
  <p.levelLeft>
    <h1 class="title is-3">
      View diff
    </h1>
  </p.levelLeft>
</PageHeader>

<Toolbar>
  <div class="toolbar-right-container">
    {{!-- Version to compare against --}}
    <BasicDropdown
      @class="popup-menu"
      @horizontalPosition="auto-right"
      @verticalPosition="below"
      as |D|
    >
      <D.trigger
        data-test-popup-menu-trigger="version"
        @class={{concat "toolbar-link" (if D.isOpen " is-active")}}
        @tagName="button"
      >
        Version {{@model.currentVersion}}
        <Chevron @direction="down" @isButton={{true}} />
      </D.trigger>
      <D.content @class="popup-menu-content">
        <nav class="box menu">
          <ul class="menu-list">
            {{!-- ARG TODO iterate through versions --}}
            {{#each (reverse @model.versions) as |secretVersion|}}
              <li class="action">
                <button class="link" {{on "click" (fn this.selectCurrentVersion secretVersion.version)}} >
                  Version {{secretVersion.version}}
                  {{#if (and (eq secretVersion.version @model.currentVersion) (not secretVersion.destroyed) (not secretVersion.deleted))}}
                    <Icon @glyph="check-circle-outline" class="has-text-success is-pulled-right" />
                  {{else if secretVersion.destroyed}}
                      <Icon @glyph="cancel-square-fill" class="has-text-danger is-pulled-right" />
                  {{else if secretVersion.deleted}}
                      <Icon @glyph="cancel-square-fill" class="has-text-grey is-pulled-right" />
                  {{/if}}
                </button>
              </li>
            {{/each}}
          </ul>
        </nav>
      </D.content>
    </BasicDropdown>
    {{!-- Version to compare --}}
    <div class="toolbar-right">
      <BasicDropdown
        @class="popup-menu"
        @horizontalPosition="right"
        @verticalPosition="below"
        as |D|
      >
        <D.trigger
          @class={{concat "toolbar-link" (if D.isOpen " is-active")}}
          @tagName="button"
        >
          Version {{this.getCompareVersion}}
          <Chevron @direction="down" @isButton={{true}} />
        </D.trigger>
        <D.content @class="popup-menu-content">
          <nav class="box menu">
            <ul class="menu-list">
              {{#each (reverse @model.versions) as |secretVersion|}}
                <li class="action">
                  <LinkTo class="link" @params={{array (query-params version=secretVersion.version)}} @invokeAction={{action D.actions.close}} >
                    Version {{secretVersion.version}}
                    {{#if (and (eq secretVersion.version @model.currentVersion) (not secretVersion.destroyed) (not secretVersion.deleted))}}
                      <Icon @glyph="check-circle-outline" class="has-text-success is-pulled-right" />
                    {{else if secretVersion.destroyed}}
                        <Icon @glyph="cancel-square-fill" class="has-text-danger is-pulled-right" />
                    {{else if secretVersion.deleted}}
                        <Icon @glyph="cancel-square-fill" class="has-text-grey is-pulled-right" />
                    {{/if}}
                  </LinkTo>
                </li>
              {{/each}}
            </ul>
          </nav>
        </D.content>
      </BasicDropdown>
    </div>
  </div>
</Toolbar>

<div class="form-section">
  <JsonEditor
    @value="some value"
    @showToolbar={{false}}
    @currentVersionData={{this.currentVersionData}}
    @diffView=true>
  </JsonEditor> 
</div>

