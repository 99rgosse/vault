---
layout: api
page_title: Oracle - Database - Secrets Engines - HTTP API
description: >-
  The Oracle plugin for Vault's database secrets engine generates database
  credentials to access Oracle servers.
---

# Oracle Database Plugin HTTP API

The Oracle database plugin is one of the supported plugins for the database
secrets engine. This plugin generates database credentials dynamically based on
configured roles for the Oracle database.

## Configure Connection

In addition to the parameters defined by the [Database
Backend](/api/secret/databases#configure-connection), this plugin
has a number of parameters to further configure a connection.

| Method | Path                     |
| :----- | :----------------------- |
| `POST` | `/database/config/:name` |

### Parameters

- `connection_url` `(string: <required>)` - Specifies the Oracle DSN.

- `max_open_connections` `(int: 4)` - Specifies the maximum number of open
  connections to the database.

- `max_idle_connections` `(int: 0)` - Specifies the maximum number of idle
  connections to the database. A zero uses the value of `max_open_connections`
  and a negative value disables idle connections. If larger than
  `max_open_connections` it will be reduced to be equal.

- `max_connection_lifetime` `(string: "0s")` - Specifies the maximum amount of
  time a connection may be reused. If <= 0s connections are reused forever.

- `username` `(string: "")` - The root credential username used in the connection URL.

- `password` `(string: "")` - The root credential password used in the connection URL.

- `username_template` `(string)` - [Template](/docs/concepts/username-templating) describing how
  dynamic usernames are generated.

<details>
  <summary><b>Default Username Template</b></summary>

  ```
  {{ printf "V_%s_%s_%s_%s" (.DisplayName | truncate 8) (.RoleName | truncate 8) (random 20) (unix_time) | truncate 30 | uppercase | replace "-" "_" | replace "." "_" }}
  ```

  <details>
    <summary><b>Example Usernames:</b></summary>

    | Example       |                                  |
    | ------------- | -------------------------------- |
    | `DisplayName` | `token`                          |
    | `RoleName`    | `myrolename`                     |
    | Username      | `V_TOKEN_MYROLENA_JNFRLKSZZMXJE` |

    | Example       |                                  |
    | ------------- | -------------------------------- |
    | `DisplayName` | `amuchlonger_dispname`           |
    | `RoleName`    | `role-name-with-dashes`          |
    | Username      | `V_AMUCHLON_ROLE_NAM_LUHU9XQM6Y` |

  </details>
</details>

#### Feature flags:

**These feature flags are only in v0.current so users can migrate configurations before upgrading to v0.next**

- `split_statements` `(boolean: true)` - Indicates the statements specified should be split on semi-colons.
  When true, this allows using a single string to specify multiple SQL statements.

  Example: `'CREATE USER "{{username}}"; GRANT CONNECT TO "{{username}}"` is interpreted as two separate
  statements: `CREATE USER ...` and `GRANT CONNECT ...`.

  If false this will not attempt to split the statements. This allows for more complex queries such as inline procedures

  **Note**: This applies to all statements, not just revocation statements.

- `disconnect_sessions` `(boolean: true)` - Indicates the plugin should disconnect any open sessions prior to
  running the revocation statements. If set to false, the revocation statements should include session disconnect logic
  otherwise lease revocation may fail if there are open sessions from the dynamic user.

### Sample Payload

```json
{
  "plugin_name": "oracle-database-plugin",
  "allowed_roles": "readonly",
  "connection_url": "{{username}}/{{password}}@localhost:1521/OraDoc.localhost",
  "max_open_connections": 5,
  "max_connection_lifetime": "5s",
  "username": "system",
  "password": "Oracle"
}
```

### Sample Request

```shell-session
$ curl \
    --header "X-Vault-Token: ..." \
    --request POST \
    --data @payload.json \
    http://127.0.0.1:8200/v1/database/config/oracle
```

## Statements

Statements are configured during role creation and are used by the plugin to
determine what is sent to the database on user creation, renewing, and
revocation. For more information on configuring roles see the [Role
API](/api/secret/databases#create-role) in the database secrets engine docs.

### Parameters

The following are the statements used by this plugin. If not mentioned in this
list the plugin does not support that statement type.

- `creation_statements` `(string: <required>)` – Specifies the database
  statements executed to create and configure a user. Must be a SQL statement, a string array,
  or a serialized JSON string array, containing SQL statements. May be base64 encoded.

  The following values are templated:

  - `{{username}}` - The username to be created
  - `{{password}}` - The generated password for that user
  - `{{expiration}}` - The expiration date of the user with the format: `2006-01-02 15:04:05-0700`

- `revocation_statements` `(string array)` – Specifies the database statements to
  be executed to revoke a user. Must be a SQL statement, a string array,
  or a serialized JSON string array, containing SQL statements. May be base64 encoded.
  If no statements are provided, a reasonable default is used. See
  [Revocation Statements](/api/secret/databases/oracle#revocation-statements) for more information on customizing
  this value

  The following values are templated:

  - `{{username}}` - The username to be revoked

- `rotation_statements` `(string array)` - Specifies the database statements executed to rotate
  a static user's credentials. Must be a SQL statement, a string array,
  or a serialized JSON string array, containing SQL statements. May be base64 encoded.

  The following values are templated:

  - `{{username}}` - The username to be updated
  - `{{password}}` - The generated password for that user

### Revocation Statements

In order to support more Oracle environments, v0.current changed the behavior of revocation statements.
Previously, the process was:

1. Plugin attempts to disconnect any open sessions for a given user (hard coded to query the `v$session` or
   `gv$session` view depending on the plugin version)
2. Revocation statements split on `;`
3. Revocation statements run against the database

Step 1 (hard coded disconnect logic) presented a problem for users who did not have (or did not have access to)
the system view, as well as users that wanted or needed to use alternative processes such as stored procedures
to disconnect users (example: [AWS RDS](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Appendix.Oracle.CommonDBATasks.System.html#Appendix.Oracle.CommonDBATasks.DisconnectingSession)
which has a stored procedure to disconnect user sessions). Step 2 presented a problem for users who wanted to use more
complex queries such as in-line procedures or any queries that required retaining any semi-colons.

In order to make the plugin more flexible, it needed to allow for custom disconnect session queries which also
required allowing for semi-colons in the revocation queries. This has been solved by including two new
feature flags: [`split_statements`](/api/secret/databases/oracle#split_statements) and
[`disconnect_sessions`](/api/secret/databases/oracle#disconnect_sessions).

#### Upgrading Configurations

These two feature flags are only available in v0.current and are removed in v0.next. v0.next also removes the hard
coded disconnect logic and the auto-splitting of statements. In order to migrate to v0.next, the following steps will
need to be taken:

-> This example only shows `revocation_statements`, but these steps apply to `creation_statements`,
   `rotation_statements`, and `root_rotation_statements`.

Assuming this is the current `revocation_statements`: `"REVOKE CONNECT FROM {{username}}; REVOKE CREATE SESSION FROM {{username}}; DROP USER {{username}}"`

1. Convert single string statements to an array

  <Tabs>
  <Tab heading="CLI">

  ```
  revocation_statements="REVOKE CONNECT FROM {{username}}" \
  revocation_statements="REVOKE CREATE SESSION FROM {{username}}" \
  revocation_statements="DROP USER {{username}}"
  ```

  </Tab>

  <Tab heading="JSON">

  ```json
  {
    "revocation_statements": [
      "REVOKE CONNECT FROM {{username}}",
      "REVOKE CREATE SESSION FROM {{username}}",
      "DROP USER {{username}}"
    ]
  }
  ```
  </Tab>

  </Tabs>

2. Add session disconnect to revocation statements (can be combined with step 1)

  Note: this only applies to `revocation_statements`

  <Tabs>
  <Tab heading="CLI">

  ```
  revocation_statements="REVOKE CONNECT FROM {{username}}" \
  revocation_statements="REVOKE CREATE SESSION FROM {{username}}" \
  revocation_statements="[disconnect session query]" \
  revocation_statements="DROP USER {{username}}"
  ```

  </Tab>

  <Tab heading="JSON">

  ```json
  {
    "revocation_statements": [
    "REVOKE CONNECT FROM {{username}}",
    "REVOKE CREATE SESSION FROM {{username}}",
    "[disconnect session query]",
    "DROP USER {{username}}"
    ]
  }
  ```
  </Tab>

  </Tabs>

  Example disconnect session query:

  ```
  begin
    for x in ( select inst_id, sid, serial# from gv$session where username="{{username}}" )
    loop
      execute immediate ( 'alter system kill session '''|| x.Sid || ',' || x.Serial# || '@' || x.Inst_ID || ''' immediate' );
    end loop;
    dbms_lock.sleep(1);
  end;
  ```
